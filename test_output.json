[
  {
    "cve": "CVE-2022-36405",
    "plugin_slug": "amcharts-charts-and-maps",
    "vuln_type": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "title": "amCharts: Charts and Maps <= 1.4 - Authenticated (Contributor+) Stored Cross-Site Scripting",
    "file_path": "b/includes/editing.php",
    "vulnerable_pattern": {
      "type": "binary_expression",
      "field": "left",
      "children": [
        {
          "type": "string",
          "field": "left",
          "value": "'[amcharts id=\"'",
          "children": [
            {
              "type": "'",
              "value": "'"
            },
            {
              "type": "string_content",
              "value": "[amcharts id=\""
            },
            {
              "type": "'",
              "value": "'"
            }
          ]
        },
        {
          "type": ".",
          "field": "operator",
          "value": "."
        },
        {
          "type": "variable_name",
          "field": "right",
          "value": "$VAR1",
          "normalized": true,
          "children": [
            {
              "type": "$",
              "value": "$"
            },
            {
              "type": "name",
              "value": "post_id"
            }
          ]
        }
      ]
    },
    "patched_pattern": {
      "type": "binary_expression",
      "children": [
        {
          "type": "binary_expression",
          "field": "left",
          "children": [
            {
              "type": "string",
              "field": "left",
              "value": "'[amcharts id=\"'",
              "children": [
                {
                  "type": "'",
                  "value": "'"
                },
                {
                  "type": "string_content",
                  "value": "[amcharts id=\""
                },
                {
                  "type": "'",
                  "value": "'"
                }
              ]
            },
            {
              "type": ".",
              "field": "operator",
              "value": "."
            },
            {
              "type": "function_call_expression",
              "field": "right",
              "value": "esc_textarea( $post_id )",
              "children": [
                {
                  "type": "name",
                  "field": "function",
                  "value": "esc_textarea",
                  "security_relevant": true
                },
                {
                  "type": "arguments",
                  "field": "arguments",
                  "children": [
                    {
                      "type": "(",
                      "value": "("
                    },
                    {
                      "type": "argument",
                      "children": [
                        {
                          "type": "variable_name",
                          "value": "$VAR1",
                          "normalized": true,
                          "children": [
                            {
                              "type": "$",
                              "value": "$"
                            },
                            {
                              "type": "name",
                              "value": "post_id"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "type": ")",
                      "value": ")"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": ".",
          "field": "operator",
          "value": "."
        },
        {
          "type": "string",
          "field": "right",
          "value": "'\"]'",
          "children": [
            {
              "type": "'",
              "value": "'"
            },
            {
              "type": "string_content",
              "value": "\"]"
            },
            {
              "type": "'",
              "value": "'"
            }
          ]
        }
      ]
    },
    "pattern_type": "security_function_missing",
    "security_functions_added": [
      "esc_textarea"
    ],
    "security_functions_removed": [],
    "vulnerable_code_snippet": "'[amcharts id=\"' . $post_id",
    "patched_code_snippet": "'[amcharts id=\"' . esc_textarea( $post_id ) . '\"]'",
    "constraints": {
      "file_extension": ".php",
      "node_type": "binary_expression",
      "changed_lines": [
        [
          2,
          2
        ]
      ]
    },
    "detection_rule": {
      "pattern": {
        "type": "binary_expression",
        "field": "left",
        "children": [
          {
            "type": "string",
            "field": "left",
            "value": "'[amcharts id=\"'",
            "children": [
              {
                "type": "'",
                "value": "'"
              },
              {
                "type": "string_content",
                "value": "[amcharts id=\""
              },
              {
                "type": "'",
                "value": "'"
              }
            ]
          },
          {
            "type": ".",
            "field": "operator",
            "value": "."
          },
          {
            "type": "variable_name",
            "field": "right",
            "value": "$VAR1",
            "normalized": true,
            "children": [
              {
                "type": "$",
                "value": "$"
              },
              {
                "type": "name",
                "value": "post_id"
              }
            ]
          }
        ]
      },
      "match_type": "structural",
      "metadata": {
        "cve": "CVE-2022-36405",
        "type": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
        "severity": "high"
      }
    }
  }
]